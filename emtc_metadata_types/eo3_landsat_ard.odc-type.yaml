---
name: eo3_landsat_ard
description: EO3 for ARD Landsat Collection 3 coregistred via AROSICS # based on: https://github.com/GeoscienceAustralia/dea-config/blob/6dea7a2ff84f2da1bac6118a1a948666228d88b0/product_metadata/eo3_landsat_ard.odc-type.yaml
dataset:
  id: [id]  # No longer configurable in newer ODCs.
  sources: [lineage, source_datasets]  # No longer configurable in newer ODCs.

  grid_spatial: [grid_spatial, projection]
  measurements: [measurements]
  creation_dt: [properties, 'odc:processing_datetime']
  label: [label]
  format: [properties, 'odc:file_format']

  search_fields:
    platform:
      description: Platform code
      offset: [properties, 'eo:platform']
      indexed: false

    instrument:
      description: Instrument name
      offset: [properties, 'eo:instrument']
      indexed: false

    product_family:
      description: Product family code
      offset: [properties, 'odc:product_family']
      indexed: false

    region_code:
      description: >
        Spatial reference code from the provider.
        For Landsat region_code is a scene path row:
                '{:03d}{:03d}.format(path,row)'
        For Sentinel it is MGRS code.
        In general it is a unique string identifier
        that datasets covering roughly the same spatial
        region share.

      offset: [properties, 'odc:region_code']

    crs_raw:
      description: The raw CRS string as it appears in metadata
      offset: ['crs']
      indexed: false

    dataset_maturity:
      description: One of - stable|provisional
      offset: [properties, 'dea:dataset_maturity']

    cor_shift:
      description: Calculated absolute shift vector length in map units
      type: double
      offset: [properties, 'cor:vec_length_map']

    cloud_cover:
      description: Cloud cover percentage [0, 100]
      type: double
      offset: [properties, 'eo:cloud_cover']
    
    nodata_cover:
      description: Nodata cover percentage [0, 100]
      type: double
      offset: [properties, 'cor:nodata_cover']

    time:
      description: Acquisition time range
      type: datetime-range
      min_offset:
        - [properties, 'dtr:start_datetime']
        - [properties, datetime]
      max_offset:
        - [properties, 'dtr:end_datetime']
        - [properties, datetime]

    lon:
      description: Longitude range
      type: double-range
      min_offset:
        - [extent, lon, begin]
      max_offset:
        - [extent, lon, end]

    lat:
      description: Latitude range
      type: double-range
      min_offset:
        - [extent, lat, begin]
      max_offset:
        - [extent, lat, end]

    landsat_product_id:
      description: Landsat Product ID
      indexed: false
      offset:
        - properties
        - landsat:landsat_product_id

    # semi-auto generated below
    eo_gsd:
      description: Ground sample distance, meters
      indexed: false
      offset:
        - properties
        - eo:gsd
      type: double
    eo_sun_azimuth:
      description: 'TODO: <eo:sun_azimuth>'
      indexed: false
      offset:
        - properties
        - eo:sun_azimuth
      type: double
    eo_sun_elevation:
      description: 'TODO: <eo:sun_elevation>'
      indexed: false
      offset:
        - properties
        - eo:sun_elevation
      type: double
    
    # nodata cover 
    cor_nodata_cover:
      description: Nodata cover percentage [0, 100]
      indexed: false
      offset:
        - properties
        - cor:nodata_cover
      type: double

    # arosics coreg info
    cor_vec_length_map:
      description: Calculated absolute shift vector length in map units
      indexed: false
      offset:
        - properties
        - cor:vec_length_map
      type: double
    cor_vec_angle_deg:
      description: Calculated angle of shift vector in degrees from North
      indexed: false
      offset:
        - properties
        - cor:vec_angle_deg
      type: double
    cor_x_shift_map:
      description: Calculated map shifts X
      indexed: false
      offset:
        - properties
        - cor:x_shift_map
      type: double
    cor_y_shift_map:
      description: Calculated map shifts Y
      indexed: false
      offset:
        - properties
        - cor:y_shift_map
      type: double
    cor_x_shift_px:
      description: Total shifts in fft pixel units X
      indexed: false
      offset:
        - properties
        - cor:x_shift_px
      type: double
    cor_y_shift_px:
      description: Total shifts in fft pixel units Y
      indexed: false
      offset:
        - properties
        - cor:y_shift_px
      type: double
    cor_ssim_improved:
      description: Image similarity within the matching window has been improved by co-registration
      indexed: false
      offset:
        - properties
        - cor:ssim_improved
    cor_ssim_orig:
      description: SSIM before correction
      indexed: false
      offset:
        - properties
        - cor:ssim_orig
      type: double
    cor_ssim_deshifted:
      description: SSIM after correction
      indexed: false
      offset:
        - properties
        - cor:ssim_deshifted
      type: double
    cor_shift_reliability:
      description: Estimated reliability of the calculated shifts
      indexed: false
      offset:
        - properties
        - cor:shift_reliability
      type: double
    cor_success:
      description: Co-regsitration success status
      indexed: false
      offset:
        - properties
        - cor:success
    cor_overlap_percentage:
      description: Overlap percentage between reference and target images
      indexed: false
      offset:
        - properties
        - cor:overlap_percentage
      type: double
    cor_win_size_xy:
      description: Final windows size (X,Y)
      indexed: false
      offset:
        - properties
        - cor:win_size_xy
      type: integer
    cor_arosics_version:
      description: The release version of AROSICS used
      indexed: false
      offset:
        - properties
        - cor:arosics_version
    landsat_scene_id:
      description: Landsat Scene ID
      indexed: false
      offset:
        - properties
        - landsat:landsat_scene_id